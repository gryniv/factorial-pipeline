
# Factorial Pipeline

## README (Українською)

### Огляд

**Консольна багатопотокова Java-програма** для обчислення факторіалів чисел із вхідного файлу. Забезпечує **збереження порядку**, **контрольовану багатопоточність** та **обмеження швидкості**. Підтримує логування помилок та моніторинг прогресу.

---

## Завдання

**Мета:**
Прочитати числа з `input.txt`, обчислити факторіали та записати результати у `output.txt`.

**Вимоги:**

* **Reader Thread**: читає числа з вхідного файлу.
* **Writer Thread**: записує результати у вихідний файл у тому ж порядку.
* **Thread Pool**: паралельне виконання завдань.
* **Rate Limiting**: не більше ніж `ratePerSecond` факторіалів у секунду.
* **Обробка помилок**: некоректні рядки пишуться у файл помилок або inline.

**Формат виводу:**

```
1 = 1
4 = 24
6 = 720
```

---

## Конфігурація

Налаштовується через `AppConfig`:

| Властивість         | Опис                                                                            | Приклад      |
| ------------------- | ------------------------------------------------------------------------------- | ------------ |
| `ratePerSecond`     | Максимальна кількість обчислень за секунду (глобально).                         | `100`        |
| `maxConcurrency`    | Максимальна кількість потоків, навіть якщо користувач просить більше.           | `100`        |
| `factorialSmallMax` | Значення ≤ цього порогу попередньо обчислюються.                                | `20`         |
| `inputPath`         | Шлях до вхідного файлу (по одному числу в рядку).                               | `input.txt`  |
| `outputPath`        | Шлях до вихідного файлу.                                                        | `output.txt` |
| `errorsPath`        | Шлях до файлу помилок. Якщо дорівнює вихідному файлу — помилки пишуться inline. | `errors.txt` |

---

## Режими логування помилок

### Inline Mode

```
5 = 120
-3
7 = 5040
```

### Separate File Mode

`output.txt`:

```
5 = 120
7 = 5040
```

`errors.txt`:

```
Line 2: [-3] -> negative number not allowed (-3)
Line 3: [abc] -> not a valid integer (abc)
```

---

## Як це працює

* **ReaderTask**: читає, перевіряє, відправляє завдання; підтримує «tailing».
* **Worker Threads**: обчислюють факторіали з кешуванням, дотримуючись rate limiting.
* **WriterTask**: зберігає порядок результатів.
* **ErrorLogger**: пише у файл або чергу.
* **ProgressTask**: показує статистику.
* **FactorialPipeline**: координує всі компоненти.

**Приклад прогресу:**

```
Progress | read 1404 | submitted 1400 | completed 1300 | errors 3 | pool 100 | rate 100/s
```

---

## Використання

### Приклад запуску (inline errors режим)

```
Enter pool size (positive integer): 100
CLI pool=100, effective pool=100, rate=100/s, inlineErrors=true
Progress | read 38346 | submitted 38273 | completed 38273 | errors 73 | pool 100 | rate 100/s | mode=INLINE_TO_OUTPUT | elapsed 00:06:23.749 (383749 ms)
```

### Пояснення метрик

* **read** — загальна кількість прочитаних рядків (включно з невалідними/порожніми).
* **submitted** — відправлені у пул задачі (тільки валідні рядки).
* **completed** — завершені обчислення факторіалів.
* **errors** — кількість невалідних рядків (записані inline або у файл помилок).
* **pool** — фактична кількість робочих потоків.
* **rate** — глобальне обмеження пропускної здатності (rate limiter).
* **mode** — місце запису помилок: `INLINE_TO_OUTPUT` або `SEPARATE_FILE`.
* **elapsed** — загальний «стіночний» час від старту.

## Примітки

* Порядок результатів завжди зберігається.
* Помилки не блокують результати.
* Для малих чисел факторіали кешуються.
* Код легко розширювати.

---

## Ліцензія

MIT License
